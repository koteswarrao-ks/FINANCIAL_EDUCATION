<div class="profile-analysis-container">
  <div class="header">
    <h1>üîç Profile Analysis</h1>
    <div class="child-selector">
      <label>Child ID:</label>
      <input 
        type="text" 
        [(ngModel)]="childId" 
        placeholder="kid_001"
        [disabled]="isLoading"
      />
      <button 
        (click)="analyzeProfile()" 
        [disabled]="isLoading"
        class="btn-analyze"
      >
        {{ isLoading ? 'Analyzing...' : 'Analyze Profile' }}
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-section" *ngIf="isLoading">
    <div class="loading">
      <div class="spinner"></div>
      <h2>Analyzing Profile...</h2>
      <p>We're analyzing transaction data and generating personalized insights</p>
    </div>
  </div>

  <!-- Error State -->
  <div class="error-section" *ngIf="error && !isLoading">
    <div class="error-card">
      <div class="error-icon">‚ùå</div>
      <h2>Analysis Failed</h2>
      <p>{{ error }}</p>
      <button (click)="analyzeProfile()" class="btn-retry">Retry Analysis</button>
    </div>
  </div>

  <!-- Results Section -->
  <div class="results-section" *ngIf="showResults && profile && reasoning">
    <!-- Basic Profile Card -->
    <div class="profile-card">
      <div class="card-header">
        <h2>üë§ Child Profile</h2>
      </div>
      <div class="profile-content">
        <div class="profile-avatar">
          <div class="avatar-circle" [style.background]="avatarError ? userProfileService.getAvatarGradient(profile.name) : 'transparent'">
            <img 
              *ngIf="avatarUrl && !avatarError" 
              [src]="avatarUrl" 
              [alt]="profile.name + ' avatar'"
              (error)="avatarError = true"
              class="avatar-image"
            />
            <span *ngIf="avatarError || !avatarUrl" class="avatar-initial">
              {{ profile.name.charAt(0) }}
            </span>
          </div>
        </div>
        <div class="profile-details">
          <h3>{{ profile.name }}</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="label">Age:</span>
              <span class="value">{{ profile.age }} years</span>
            </div>
            <div class="detail-item">
              <span class="label">Grade:</span>
              <span class="value">{{ profile.grade }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Country:</span>
              <span class="value">{{ profile.country }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Child ID:</span>
              <span class="value">{{ profile.childId }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Analysis Reasoning Card -->
    <div class="reasoning-card">
      <div class="card-header">
        <h2>üß† Analysis Reasoning</h2>
        <p class="subtitle">How we determined the personalization insights</p>
      </div>
      <div class="reasoning-content">
        <div class="reasoning-item">
          <div class="reasoning-icon">üéØ</div>
          <div class="reasoning-text">
            <h4>Hobbies Identified</h4>
            <p>{{ reasoning.hobbies }}</p>
          </div>
        </div>
        
        <div class="reasoning-item">
          <div class="reasoning-icon">üìö</div>
          <div class="reasoning-text">
            <h4>Favorite Subjects</h4>
            <p>{{ reasoning.subjects }}</p>
          </div>
        </div>
        
        <div class="reasoning-item">
          <div class="reasoning-icon">üé®</div>
          <div class="reasoning-text">
            <h4>Learning Style</h4>
            <p>{{ reasoning.learningStyle }}</p>
          </div>
        </div>
        
        <div class="reasoning-item">
          <div class="reasoning-icon">üí∞</div>
          <div class="reasoning-text">
            <h4>Pocket Money Pattern</h4>
            <p>{{ reasoning.pocketMoney }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Personalization Details Card -->
    <div class="personalization-card">
      <div class="card-header">
        <h2>‚ú® Personalization Insights</h2>
        <p class="subtitle">Customized learning recommendations</p>
      </div>
      <div class="personalization-content">
        <div class="insight-section">
          <div class="section-header">
            <h4>üéØ Hobbies</h4>
            <div class="header-actions">
              <button 
                *ngIf="!editingHobbies" 
                (click)="startEditingHobbies()" 
                class="btn-edit"
                title="Edit hobbies"
                type="button"
                [disabled]="!profile"
              >
                ‚úèÔ∏è Edit
              </button>
              <div *ngIf="editingHobbies" class="edit-controls">
                <button (click)="cancelEditingHobbies()" class="btn-cancel" type="button">Cancel</button>
              </div>
            </div>
          </div>
          <div class="tags-container" *ngIf="profile.personalization.hobbies && profile.personalization.hobbies.length > 0">
            <span class="tag hobby-tag" *ngFor="let hobby of profile.personalization.hobbies">
              {{ hobby }}
              <button 
                *ngIf="editingHobbies" 
                (click)="deleteHobby(hobby)" 
                class="btn-delete-tag"
                title="Delete hobby"
              >
                √ó
              </button>
            </span>
          </div>
          <div *ngIf="!profile.personalization.hobbies || profile.personalization.hobbies.length === 0" class="empty-state">
            <p class="empty-message">No hobbies added yet</p>
          </div>
          <div *ngIf="editingHobbies" class="add-item-form">
            <input 
              type="text" 
              [(ngModel)]="newHobby" 
              placeholder="Enter new hobby"
              (keyup.enter)="addHobby()"
              class="input-add"
            />
            <button (click)="addHobby()" class="btn-add">+ Add</button>
          </div>
          <div *ngIf="!editingHobbies && (!profile.personalization.hobbies || profile.personalization.hobbies.length === 0)" class="add-item-form">
            <button (click)="startEditingHobbies()" class="btn-add">+ Add Hobby</button>
          </div>
        </div>
        
        <div class="insight-section">
          <div class="section-header">
            <h4>üìö Favorite Subjects</h4>
            <div class="header-actions">
              <button 
                *ngIf="!editingSubjects" 
                (click)="startEditingSubjects()" 
                class="btn-edit"
                title="Edit favorite subjects"
                type="button"
                [disabled]="!profile"
              >
                ‚úèÔ∏è Edit
              </button>
              <div *ngIf="editingSubjects" class="edit-controls">
                <button (click)="cancelEditingSubjects()" class="btn-cancel" type="button">Cancel</button>
              </div>
            </div>
          </div>
          <div class="tags-container" *ngIf="profile.personalization.favoriteSubjects && profile.personalization.favoriteSubjects.length > 0">
            <span class="tag subject-tag" *ngFor="let subject of profile.personalization.favoriteSubjects">
              {{ subject }}
              <button 
                *ngIf="editingSubjects" 
                (click)="deleteSubject(subject)" 
                class="btn-delete-tag"
                title="Delete subject"
              >
                √ó
              </button>
            </span>
          </div>
          <div *ngIf="!profile.personalization.favoriteSubjects || profile.personalization.favoriteSubjects.length === 0" class="empty-state">
            <p class="empty-message">No favorite subjects added yet</p>
          </div>
          <div *ngIf="editingSubjects" class="add-item-form">
            <input 
              type="text" 
              [(ngModel)]="newSubject" 
              placeholder="Enter new subject"
              (keyup.enter)="addSubject()"
              class="input-add"
            />
            <button (click)="addSubject()" class="btn-add">+ Add</button>
          </div>
          <div *ngIf="!editingSubjects && (!profile.personalization.favoriteSubjects || profile.personalization.favoriteSubjects.length === 0)" class="add-item-form">
            <button (click)="startEditingSubjects()" class="btn-add">+ Add Subject</button>
          </div>
        </div>
        
        <div class="insight-section">
          <h4>üé® Preferred Learning Style</h4>
          <div class="learning-style-badge">
            {{ profile.personalization.preferredLearningStyle }}
          </div>
        </div>
        
        <div class="insight-section">
          <h4>üí∞ Pocket Money Details</h4>
          <div class="pocket-money-info">
            <div class="money-amount">
              ‚Çπ{{ profile.personalization.pocketMoney.amount }}
            </div>
            <div class="money-frequency">
              {{ profile.personalization.pocketMoney.frequency }}
            </div>
            <div class="money-currency">
              {{ profile.personalization.pocketMoney.currency }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Button -->
    <div class="action-section">
      <button 
        class="btn-primary btn-large" 
        (click)="onReadStories()"
      >
        üìñ Read Stories
      </button>
    </div>
  </div>
</div>



